config("ngtcp2_public_config") {
  # gn makes replacing variables in a template file harder than it should be so 
  # we just add our own version.h file for ngtcp2 with a hardcoded version which
  # we add to the include search path with ".".
  defines = ["HAVE_ARPA_INET_H"]
  include_dirs = [
    ".",
    "src/lib/includes"
  ]
}

config("ngtcp2_private_config") {
  defines = [ 
    "BUILDING_NGTCP2"
  ]
  cflags = [
    "-Wno-return-type",
    "-Wno-unused-variable",
    "-Wno-sometimes-uninitialized"
  ]
}

component("ngtcp2") {
  sources = [
    "src/lib/ngtcp2_acktr.c",
    "src/lib/ngtcp2_acktr.h",
    "src/lib/ngtcp2_addr.c",
    "src/lib/ngtcp2_addr.h",
    "src/lib/ngtcp2_buf.c",
    "src/lib/ngtcp2_buf.h",
    "src/lib/ngtcp2_cc.c",
    "src/lib/ngtcp2_cc.h",
    "src/lib/ngtcp2_cid.c",
    "src/lib/ngtcp2_cid.h",
    "src/lib/ngtcp2_conn.c",
    "src/lib/ngtcp2_conn.h",
    "src/lib/ngtcp2_conv.c",
    "src/lib/ngtcp2_conv.h",
    "src/lib/ngtcp2_crypto.c",
    "src/lib/ngtcp2_crypto.h",
    "src/lib/ngtcp2_err.c",
    "src/lib/ngtcp2_err.h",
    "src/lib/ngtcp2_gaptr.c",
    "src/lib/ngtcp2_gaptr.h",
    "src/lib/ngtcp2_idtr.c",
    "src/lib/ngtcp2_idtr.h",
    "src/lib/ngtcp2_ksl.c",
    "src/lib/ngtcp2_ksl.h",
    "src/lib/ngtcp2_log.c",
    "src/lib/ngtcp2_log.h",
    "src/lib/ngtcp2_macro.h",
    "src/lib/ngtcp2_map.c",
    "src/lib/ngtcp2_map.h",
    "src/lib/ngtcp2_mem.c",
    "src/lib/ngtcp2_mem.h",
    "src/lib/ngtcp2_net.h",
    "src/lib/ngtcp2_path.c",
    "src/lib/ngtcp2_path.h",
    "src/lib/ngtcp2_pkt.c",
    "src/lib/ngtcp2_pkt.h",
    "src/lib/ngtcp2_ppe.c",
    "src/lib/ngtcp2_ppe.h",
    "src/lib/ngtcp2_pq.c",
    "src/lib/ngtcp2_pq.h",
    "src/lib/ngtcp2_pv.c",
    "src/lib/ngtcp2_pv.h",
    "src/lib/ngtcp2_range.c",
    "src/lib/ngtcp2_range.h",
    "src/lib/ngtcp2_ringbuf.c",
    "src/lib/ngtcp2_ringbuf.h",
    "src/lib/ngtcp2_rob.c",
    "src/lib/ngtcp2_rob.h",
    "src/lib/ngtcp2_rtb.c",
    "src/lib/ngtcp2_rtb.h",
    "src/lib/ngtcp2_str.c",
    "src/lib/ngtcp2_str.h",
    "src/lib/ngtcp2_strm.c",
    "src/lib/ngtcp2_strm.h",
    "src/lib/ngtcp2_vec.c",
    "src/lib/ngtcp2_vec.h",
  ]

  configs += [":ngtcp2_private_config"]
  public_configs = [":ngtcp2_public_config"]
}